{% extends "templates/pageModel.njk" %}

{% block conteudoPagina %}
<div class="row">
  <div class="col-12 mb-3">
    <a href="/Autores/FCrAutores" class="btn btn-primary">Novo Autor</a>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <table class="table table-striped table-hover" id="tbAutores">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Nacionalidade</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scriptsPagina %}
<script>
  const backendUrl = "http://localhost:40000";

  async function carregarAutores() {
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "/Login";
      return;
    }

    const resposta = await fetch(backendUrl + "/getAllAutores", {
      method: "GET",
      headers: {
        Authorization: "Bearer " + token
      }
    });

    const dados = await resposta.json();
    const tbody = document.querySelector("#tbAutores tbody");
    tbody.innerHTML = "";

    if (dados.status === "ok" && dados.registro && dados.registro.length > 0) {
      dados.registro.forEach((autor) => {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.innerText = autor.autorid;

        const tdNome = document.createElement("td");
        tdNome.innerText = autor.nome;

        const tdNac = document.createElement("td");
        tdNac.innerText = autor.nacionalidade || "";

        const tdAcoes = document.createElement("td");
        const linkEditar = document.createElement("a");
        linkEditar.href = "/Autores/FRUDrAutores?autorid=" + autor.autorid;
        linkEditar.className = "btn btn-sm btn-secondary";
        linkEditar.innerText = "Editar";
        tdAcoes.appendChild(linkEditar);

        tr.appendChild(tdId);
        tr.appendChild(tdNome);
        tr.appendChild(tdNac);
        tr.appendChild(tdAcoes);

        tbody.appendChild(tr);
      });
    }
  }

  document.addEventListener("DOMContentLoaded", carregarAutores);
</script>
{% endblock %}
